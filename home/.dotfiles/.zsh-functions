#!/bin/bash

local dotfiles_dir="/Users/$(whoami)/.homesick/repos/dotfiles"
local functions_path="$dotfiles_dir/home/.dotfiles/functions/"

. "$functions_path.function-navigation_and_files"
. "$functions_path.function-compression"
. "$functions_path.function-audio"
. "$functions_path.function-git"
. "$functions_path.function-images"
. "$functions_path.function-server"
. "$functions_path.function-osx"
. "$functions_path.function-coding"

# -----------------------------------------------------------------------------
# Helpers
# -----------------------------------------------------------------------------

# Check if a command exists
# Example
# if _command_exists nvim; then echo 'Nvim exists!'; fi
# http://stackoverflow.com/a/3931779
_command_exists() {
  type "$1" &> /dev/null ;
}

# -----------------------------------------------------------------------------
# Tmux
# -----------------------------------------------------------------------------

# Close other panes and open gulp in new split
# Also has the nice side effect of closing the pane after the gulp task has ended
function tgulp() {
  PANE_COUNT=`tmux display-message -p '#{window_panes}'`
  if [[ $PANE_COUNT == 2 ]]; then
    tmux kill-pane -a
  fi
  tmux split-window -d "gulp $@"
  tmux resize-pane -D 10 # Add a bit more space to the non-gulp pane
}

# -----------------------------------------------------------------------------
# Etc
# -----------------------------------------------------------------------------

# Uses tree - install first
# brew install tree
function t() {
  tree $1 -I '.git|node_modules|bower_components|.DS_Store' --dirsfirst --filelimit 15 -L 3 -C $2
}

# Opens a man page as a pdf in preview
function pman() {
  man -t $1 | open -f -a /Applications/Preview.app
 }

# Opens man page in Sublime
function sman() {
 man "${1}" | col -b | open -f -a /Applications/Sublime\ Text.app/Contents/MacOS/Sublime\ Text
}


# [npmls]:
# Show node packages without dependencies
function npmls() {
  npm ls --depth=0 -g "$@" 2>/dev/null
}

# [numhash]:
# Create a numeric hash with x digits
function numhash() {

  # If there is no parameter passed create a 32 character hash
  if [[ -z $1 ]]; then
    local digit=32
  else
    local digit="$1"
  fi

  # Create a numeric x character long hash
  cat /dev/urandom | env LC_CTYPE=C tr -dc '0-9' | fold -w $digit | head -n 1
}

# [xhash]:
# Create a numeric hash with x digits
function xhash() {

  # If there is no parameter passed create a 32 character hash
  if [[ -z $1 ]]; then
    local digit=32
  else
    local digit="$1"
  fi

  # Create a numeric x character long hash
  cat /dev/urandom | env LC_CTYPE=C tr -dc 'a-zA-Z0-9' | fold -w $digit | head -n 1
}

# Fix the asepsis control after updating
function ds_store_update_cleaner () {
  asepsisctl uninstall_wrapper
  asepsisctl install_wrapper
}
