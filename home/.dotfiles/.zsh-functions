#!/bin/bash

local dotfiles_dir="/Users/$(whoami)/.homesick/repos/dotfiles"
local functions_path="$dotfiles_dir/home/.dotfiles/functions/"

. "$functions_path.function-navigation_and_files"
. "$functions_path.function-compression"
. "$functions_path.function-audio"
. "$functions_path.function-git"
. "$functions_path.function-images"
. "$functions_path.function-server"
. "$functions_path.function-osx"
. "$functions_path.function-coding"
. "$functions_path.function-mercurial"

#==============================================================================#
# Time Management
#==============================================================================#

# Watson report for each day of the week
# TODO: Make this less repetitive ;)
function wreport() {
  mon=$(date -v -Mon "+%Y-%m-%d")
  tue=$( date -v -Tue "+%Y-%m-%d" )
  wed=$( date -v -Wed "+%Y-%m-%d" )
  thu=$( date -v -Thu "+%Y-%m-%d" )
  fri=$( date -v -Fri "+%Y-%m-%d" )
  watson report --from $mon --to $mon
  watson report --from $tue --to $tue
  watson report --from $wed --to $wed
  watson report --from $thu --to $thu
  watson report --from $fri --to $fri
}

#==============================================================================#
# TMUX
#==============================================================================#

# Close other panes and open gulp in new split
function tgulp() {
  PANE_COUNT=`tmux display-message -p '#{window_panes}'`
  if [[ $PANE_COUNT == 2 ]]; then
    tmux kill-pane -a
  fi
 tmux split-window -d "gulp"
}

#==============================================================================#
# Etc
#==============================================================================#

# Uses tree - install first
# brew install tree
function t() {
  tree -I '.git|node_modules|bower_components|.DS_Store' --dirsfirst --filelimit 15 -L ${1:-3} -C $2
}

# Opens a man page as a pdf in preview
function pman() {
  man -t $1 | open -f -a /Applications/Preview.app
 }

# Opens man page in Sublime
function sman() {
 man "${1}" | col -b | open -f -a /Applications/Sublime\ Text.app/Contents/MacOS/Sublime\ Text
}


# [npmls]:
# Show node packages without dependencies
function npmls() {
  npm ls --depth=0 -g "$@" 2>/dev/null
}

# [numhash]:
# Create a numeric hash with x digits
function numhash() {

  # If there is no parameter passed create a 32 character hash
  if [[ -z $1 ]]; then
    local digit=32
  else
    local digit="$1"
  fi

  # Create a numeric x character long hash
  cat /dev/urandom | env LC_CTYPE=C tr -dc '0-9' | fold -w $digit | head -n 1
}

# [xhash]:
# Create a numeric hash with x digits
function xhash() {

  # If there is no parameter passed create a 32 character hash
  if [[ -z $1 ]]; then
    local digit=32
  else
    local digit="$1"
  fi

  # Create a numeric x character long hash
  cat /dev/urandom | env LC_CTYPE=C tr -dc 'a-zA-Z0-9' | fold -w $digit | head -n 1
}

function panmd () {
  local src=$1
  local dst=$2
  pandoc -s "$1" -t markdown -o "$2"
}

# Fix the asepsis control after updating
function ds_store_update_cleaner () {
  asepsisctl uninstall_wrapper
  asepsisctl install_wrapper
}
